<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.546">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Bari Garnier">
<meta name="dcterms.date" content="2024-01-15">

<title>Master ISDD fiches - TP3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/UniversiteParisCite_logo_horizontal_noir_RVB.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Master ISDD fiches</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-mda" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">MDA</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-mda">    
        <li>
    <a class="dropdown-item" href="../../mda/mda.html">
 <span class="dropdown-text">Massive Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../mda/TP1/tp1.html">
 <span class="dropdown-text">TP1 : Classification des données</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../mda/TP2/tp2.html">
 <span class="dropdown-text">TP2 : Analyse en Composantes Principales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../mda/TP3/tp3.html">
 <span class="dropdown-text">TP3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../mda/TP4/tp4.html">
 <span class="dropdown-text">TP4 : arbres de partitionnement, cart</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://martinbagar.github.io/Master_ISDD_fiches/"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#régression-linéaire-sur-les-données-initiales-non-nettoyées" id="toc-régression-linéaire-sur-les-données-initiales-non-nettoyées" class="nav-link active" data-scroll-target="#régression-linéaire-sur-les-données-initiales-non-nettoyées">Régression linéaire sur les données initiales, non nettoyées</a></li>
  <li><a href="#calcul-du-modèle-de-régression-linéaire-multiple" id="toc-calcul-du-modèle-de-régression-linéaire-multiple" class="nav-link" data-scroll-target="#calcul-du-modèle-de-régression-linéaire-multiple">Calcul du modèle de régression linéaire multiple</a>
  <ul class="collapse">
  <li><a href="#préparation-du-jeu-de-données" id="toc-préparation-du-jeu-de-données" class="nav-link" data-scroll-target="#préparation-du-jeu-de-données">Préparation du jeu de données</a></li>
  <li><a href="#etude-de-lautocorrélation" id="toc-etude-de-lautocorrélation" class="nav-link" data-scroll-target="#etude-de-lautocorrélation">Etude de l’autocorrélation</a></li>
  <li><a href="#sélection-des-descripteurs-pertinents" id="toc-sélection-des-descripteurs-pertinents" class="nav-link" data-scroll-target="#sélection-des-descripteurs-pertinents">Sélection des descripteurs pertinents</a></li>
  <li><a href="#etablissement-du-modèle" id="toc-etablissement-du-modèle" class="nav-link" data-scroll-target="#etablissement-du-modèle">Etablissement du modèle</a></li>
  <li><a href="#réalisation-du-step" id="toc-réalisation-du-step" class="nav-link" data-scroll-target="#réalisation-du-step">Réalisation du step</a></li>
  </ul></li>
  <li><a href="#regression-logistique-multiple" id="toc-regression-logistique-multiple" class="nav-link" data-scroll-target="#regression-logistique-multiple">Regression logistique multiple</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">TP3</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Martin Bari Garnier </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="régression-linéaire-sur-les-données-initiales-non-nettoyées" class="level1">
<h1>Régression linéaire sur les données initiales, non nettoyées</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/X.Rdata"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/Y.Rdata"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/train.dtf.Rdata"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/test.dtf.Rdata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>train_score <span class="ot">&lt;-</span> train.dtf[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(train.dtf)<span class="sc">==</span><span class="st">"drugg"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>lm_score <span class="ot">&lt;-</span> <span class="fu">lm</span>(score<span class="sc">~</span>., <span class="at">data =</span> train_score)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = score ~ ., data = train_score)

Residuals:
    Min      1Q  Median      3Q     Max 
-106.08  -21.10    2.80   21.39   93.09 

Coefficients: (1 not defined because of singularities)
                                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                        -77.74671  154.75161  -0.502   0.6174    
aromatic                             7.14923   81.80382   0.087   0.9307    
polar                               11.97115   69.71791   0.172   0.8643    
aliphatic                          111.34361   82.29585   1.353   0.1815    
charged                            -76.68689  105.91847  -0.724   0.4721    
negative                           -17.76245  120.01168  -0.148   0.8829    
positive                                  NA         NA      NA       NA    
hydrophobic                       -124.73217   80.54730  -1.549   0.1271    
small                              -36.48391   70.13055  -0.520   0.6050    
tiny                                80.08128   77.04033   1.039   0.3031    
C_ATOM                               0.44659    0.59816   0.747   0.4584    
C_RESIDUES                          -0.74231    1.56561  -0.474   0.6372    
Mean_alpha.sphere_radius            73.90467   37.38355   1.977   0.0530 .  
Real_volume                          0.19245    0.02564   7.505 5.07e-10 ***
Proportion_of_apolar_alpha_sphere  -32.00992   47.84819  -0.669   0.5063    
Mean_B.factor                      -75.21093   41.35019  -1.819   0.0743 .  
Mean_alpha.sphere_SA              -229.92250  196.10652  -1.172   0.2460    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 38.33 on 56 degrees of freedom
Multiple R-squared:  0.9485,    Adjusted R-squared:  0.9347 
F-statistic: 68.74 on 15 and 56 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(lm_score$fitted.values, dtf_new$score)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous avons un modèle avec un R-carré ajusté à 0.9392 donc notre modèle est très performant. Il faut cependant avoir en tête que les données n’ont pas été normalisées. En effet, Real_volume prend toute la variabilité du fait de son ordre de grandeur bien supérieur aux autres descripteurs. Nous voyons aussi qu’il y a un descripteur avec des coefficients NA ce qui indique une corrélation ou une colinéarité avec un ou plusieurs autres descripteurs.</p>
</section>
<section id="calcul-du-modèle-de-régression-linéaire-multiple" class="level1">
<h1>Calcul du modèle de régression linéaire multiple</h1>
<section id="préparation-du-jeu-de-données" class="level2">
<h2 class="anchored" data-anchor-id="préparation-du-jeu-de-données">Préparation du jeu de données</h2>
<p>A l’aide d’un <code>summary()</code>, nous avons vu qu’il n’y avait pas de NA dans notre jeu de données. Nous devons enlever les valeurs manquantes car la régression effectuée requiert une matrice complète. D’autres méthodes par inférence existent afin de remplacer des valeurs manquantes mais par définition elles dénaturent la qualité des résultats. Pour ne pas prendre ne compte les valeurs manquantes, nous pouvons modifier le df en utilisant na.omit() ou nous pouvons effectuer la régression multiple sans prendre en compte les colonnes ou lignes contenant les valeurs manquantes.</p>
</section>
<section id="etude-de-lautocorrélation" class="level2">
<h2 class="anchored" data-anchor-id="etude-de-lautocorrélation">Etude de l’autocorrélation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Création de la matrice de corrélation</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cor_x <span class="ot">&lt;-</span> <span class="fu">cor</span>(X)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(cor_x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mise en évidence des descripteurs corrélés et colinéaires</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">findCorrelation</span>(cor_x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findLinearCombos</span>(cor_x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$linearCombos
$linearCombos[[1]]
[1] 6 4 5


$remove
[1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X[, <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">13</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "positive"    "C_RESIDUES"  "Real_volume"</code></pre>
</div>
</div>
<p>Nous avons choisi un seuil de corrélation de 0,9 correspondant à la valeur par défaut car elle nous permet de retirer uniquement deux colonnes. Nous voulons garder un jeu de descripteurs large et varié. Cette fonction nous indique que les colonnes 6, 4, 5 sont colinéaires. Elle nous conseille de retirer la colonne 6.</p>
</section>
<section id="sélection-des-descripteurs-pertinents" class="level2">
<h2 class="anchored" data-anchor-id="sélection-des-descripteurs-pertinents">Sélection des descripteurs pertinents</h2>
<p>Nous réalisons une régression linéaire pour chaque descripteur en fonction du score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>clean_train_score <span class="ot">&lt;-</span> train_score[, <span class="fu">which</span>(<span class="sc">!</span><span class="fu">colnames</span>(train_score) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"C_RESIDUES"</span>, <span class="st">"positive"</span>, <span class="st">"Real_volume"</span>))]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(clean_train_score)<span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  lm_tmp <span class="ot">&lt;-</span> <span class="fu">lm</span>(clean_train_score<span class="sc">$</span>score<span class="sc">~</span>clean_train_score[, i])</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  summary_model <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_tmp)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> summary_model<span class="sc">$</span>coefficients[, <span class="st">"Pr(&gt;|t|)"</span>][<span class="dv">2</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(p_values, p_value)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(p_values) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(clean_train_score)[<span class="dv">2</span><span class="sc">:</span><span class="dv">14</span>]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>val_desc <span class="ot">&lt;-</span> <span class="fu">names</span>(p_values[<span class="fu">which</span>(p_values<span class="sc">&lt;</span><span class="fl">0.2</span>)])</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>dtf_final <span class="ot">&lt;-</span> dtf_new[<span class="fu">c</span>(<span class="st">"score"</span>, val_desc)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="etablissement-du-modèle" class="level2">
<h2 class="anchored" data-anchor-id="etablissement-du-modèle">Etablissement du modèle</h2>
</section>
<section id="réalisation-du-step" class="level2">
<h2 class="anchored" data-anchor-id="réalisation-du-step">Réalisation du step</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>slm_original <span class="ot">&lt;-</span> <span class="fu">lm</span>(score<span class="sc">~</span>., <span class="at">data =</span> train_score)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>slm_original_res <span class="ot">&lt;-</span> slm_original<span class="sc">$</span>residuals</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>slm_stepped <span class="ot">&lt;-</span> <span class="fu">step</span>(slm_original, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=538.98
score ~ aromatic + polar + aliphatic + charged + negative + positive + 
    hydrophobic + small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + 
    Mean_alpha.sphere_SA


Step:  AIC=538.98
score ~ aromatic + polar + aliphatic + charged + negative + hydrophobic + 
    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + 
    Mean_alpha.sphere_SA

                                    Df Sum of Sq    RSS    AIC
- aromatic                           1        11  82303 536.99
- negative                           1        32  82324 537.01
- polar                              1        43  82335 537.02
- C_RESIDUES                         1       330  82622 537.27
- small                              1       398  82690 537.33
- Proportion_of_apolar_alpha_sphere  1       658  82950 537.55
- charged                            1       770  83062 537.65
- C_ATOM                             1       819  83111 537.69
- tiny                               1      1588  83880 538.35
- Mean_alpha.sphere_SA               1      2020  84312 538.72
&lt;none&gt;                                            82292 538.98
- aliphatic                          1      2690  84982 539.29
- hydrophobic                        1      3524  85816 540.00
- Mean_B.factor                      1      4862  87153 541.11
- Mean_alpha.sphere_radius           1      5743  88035 541.84
- Real_volume                        1     82760 165052 587.09

Step:  AIC=536.99
score ~ polar + aliphatic + charged + negative + hydrophobic + 
    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + 
    Mean_alpha.sphere_SA

                                    Df Sum of Sq    RSS    AIC
- negative                           1        28  82332 535.01
- polar                              1        72  82375 535.05
- C_RESIDUES                         1       335  82638 535.28
- small                              1       524  82827 535.44
- Proportion_of_apolar_alpha_sphere  1       649  82952 535.55
- C_ATOM                             1       810  83113 535.69
- charged                            1       897  83200 535.77
- tiny                               1      1677  83980 536.44
- Mean_alpha.sphere_SA               1      2021  84324 536.73
&lt;none&gt;                                            82303 536.99
- aliphatic                          1      3358  85661 537.87
- hydrophobic                        1      4610  86913 538.91
+ aromatic                           1        11  82292 538.98
- Mean_B.factor                      1      5214  87517 539.41
- Mean_alpha.sphere_radius           1      5940  88243 540.00
- Real_volume                        1     84993 167296 586.06

Step:  AIC=535.01
score ~ polar + aliphatic + charged + hydrophobic + small + tiny + 
    C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + Real_volume + 
    Proportion_of_apolar_alpha_sphere + Mean_B.factor + Mean_alpha.sphere_SA

                                    Df Sum of Sq    RSS    AIC
- polar                              1       129  82461 533.13
- C_RESIDUES                         1       311  82643 533.28
- C_ATOM                             1       788  83119 533.70
- Proportion_of_apolar_alpha_sphere  1       841  83173 533.74
- small                              1       948  83279 533.84
- Mean_alpha.sphere_SA               1      1996  84327 534.74
- tiny                               1      2244  84575 534.95
&lt;none&gt;                                            82332 535.01
- charged                            1      2374  84706 535.06
- aliphatic                          1      3585  85917 536.08
+ negative                           1        28  82303 536.99
+ positive                           1        28  82303 536.99
+ aromatic                           1         7  82324 537.01
- hydrophobic                        1      4927  87258 537.20
- Mean_B.factor                      1      5195  87527 537.42
- Mean_alpha.sphere_radius           1      6125  88456 538.18
- Real_volume                        1     94755 177086 588.16

Step:  AIC=533.13
score ~ aliphatic + charged + hydrophobic + small + tiny + C_ATOM + 
    C_RESIDUES + Mean_alpha.sphere_radius + Real_volume + Proportion_of_apolar_alpha_sphere + 
    Mean_B.factor + Mean_alpha.sphere_SA

                                    Df Sum of Sq    RSS    AIC
- C_RESIDUES                         1       311  82772 531.40
- C_ATOM                             1       755  83216 531.78
- Proportion_of_apolar_alpha_sphere  1       899  83360 531.91
- small                              1      1103  83564 532.08
- Mean_alpha.sphere_SA               1      1949  84410 532.81
- tiny                               1      2236  84697 533.05
- charged                            1      2322  84783 533.13
&lt;none&gt;                                            82461 533.13
- aliphatic                          1      3682  86143 534.27
+ polar                              1       129  82332 535.01
+ negative                           1        86  82375 535.05
+ positive                           1        86  82375 535.05
+ aromatic                           1        45  82416 535.09
- Mean_B.factor                      1      5181  87642 535.51
- Mean_alpha.sphere_radius           1      6005  88466 536.19
- hydrophobic                        1      6063  88524 536.23
- Real_volume                        1     97115 179576 587.16

Step:  AIC=531.4
score ~ aliphatic + charged + hydrophobic + small + tiny + C_ATOM + 
    Mean_alpha.sphere_radius + Real_volume + Proportion_of_apolar_alpha_sphere + 
    Mean_B.factor + Mean_alpha.sphere_SA

                                    Df Sum of Sq    RSS    AIC
- C_ATOM                             1       524  83296 529.85
- Proportion_of_apolar_alpha_sphere  1       688  83460 529.99
- small                              1      1229  84002 530.46
- Mean_alpha.sphere_SA               1      1638  84410 530.81
- tiny                               1      1998  84771 531.11
- charged                            1      2293  85065 531.36
&lt;none&gt;                                            82772 531.40
- aliphatic                          1      3412  86185 532.31
+ C_RESIDUES                         1       311  82461 533.13
+ polar                              1       130  82643 533.28
+ aromatic                           1        57  82716 533.35
+ negative                           1        41  82732 533.36
+ positive                           1        41  82732 533.36
- Mean_B.factor                      1      4869  87642 533.51
- Mean_alpha.sphere_radius           1      5699  88472 534.19
- hydrophobic                        1      5990  88762 534.43
- Real_volume                        1     96959 179731 585.22

Step:  AIC=529.85
score ~ aliphatic + charged + hydrophobic + small + tiny + Mean_alpha.sphere_radius + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + 
    Mean_alpha.sphere_SA

                                    Df Sum of Sq     RSS    AIC
- Proportion_of_apolar_alpha_sphere  1       790   84086 528.53
- Mean_alpha.sphere_SA               1      1452   84748 529.10
- small                              1      1627   84923 529.24
- tiny                               1      2238   85534 529.76
&lt;none&gt;                                             83296 529.85
- charged                            1      2497   85794 529.98
- aliphatic                          1      3637   86933 530.93
+ C_ATOM                             1       524   82772 531.40
+ polar                              1        82   83214 531.78
+ C_RESIDUES                         1        81   83216 531.78
+ aromatic                           1        12   83284 531.84
+ negative                           1         0   83296 531.85
+ positive                           1         0   83296 531.85
- Mean_B.factor                      1      5075   88371 532.11
- hydrophobic                        1      6002   89298 532.86
- Mean_alpha.sphere_radius           1      6597   89893 533.34
- Real_volume                        1   1335762 1419058 732.00

Step:  AIC=528.53
score ~ aliphatic + charged + hydrophobic + small + tiny + Mean_alpha.sphere_radius + 
    Real_volume + Mean_B.factor + Mean_alpha.sphere_SA

                                    Df Sum of Sq     RSS    AIC
- small                              1       960   85046 527.35
- Mean_alpha.sphere_SA               1      1081   85167 527.45
- charged                            1      1867   85953 528.11
- tiny                               1      2110   86196 528.32
&lt;none&gt;                                             84086 528.53
- aliphatic                          1      2877   86963 528.95
+ Proportion_of_apolar_alpha_sphere  1       790   83296 529.85
+ C_ATOM                             1       626   83460 529.99
- Mean_B.factor                      1      4428   88514 530.23
+ C_RESIDUES                         1       220   83866 530.34
+ polar                              1       122   83964 530.43
+ negative                           1       108   83978 530.44
+ positive                           1       108   83978 530.44
+ aromatic                           1         0   84086 530.53
- hydrophobic                        1      5820   89906 531.35
- Mean_alpha.sphere_radius           1      6384   90470 531.80
- Real_volume                        1   1355876 1439962 731.05

Step:  AIC=527.35
score ~ aliphatic + charged + hydrophobic + tiny + Mean_alpha.sphere_radius + 
    Real_volume + Mean_B.factor + Mean_alpha.sphere_SA

                                    Df Sum of Sq     RSS    AIC
- tiny                               1      1164   86211 526.33
- Mean_alpha.sphere_SA               1      1347   86394 526.48
- charged                            1      1463   86509 526.58
&lt;none&gt;                                             85046 527.35
- aliphatic                          1      2694   87740 527.59
+ small                              1       960   84086 528.53
+ C_ATOM                             1       912   84134 528.57
+ negative                           1       485   84561 528.94
+ positive                           1       485   84561 528.94
+ polar                              1       231   84815 529.15
+ C_RESIDUES                         1       231   84816 529.15
+ aromatic                           1       220   84826 529.16
- Mean_B.factor                      1      4672   89718 529.20
+ Proportion_of_apolar_alpha_sphere  1       124   84923 529.24
- hydrophobic                        1      4865   89912 529.35
- Mean_alpha.sphere_radius           1      6723   91769 530.83
- Real_volume                        1   1387743 1472790 730.67

Step:  AIC=526.33
score ~ aliphatic + charged + hydrophobic + Mean_alpha.sphere_radius + 
    Real_volume + Mean_B.factor + Mean_alpha.sphere_SA

                                    Df Sum of Sq     RSS    AIC
- aliphatic                          1      1677   87887 525.71
- Mean_alpha.sphere_SA               1      1929   88140 525.92
&lt;none&gt;                                             86211 526.33
- charged                            1      3014   89224 526.80
+ tiny                               1      1164   85046 527.35
+ C_ATOM                             1       880   85330 527.59
- hydrophobic                        1      4172   90383 527.73
+ negative                           1       659   85551 527.77
+ positive                           1       659   85551 527.77
+ C_RESIDUES                         1       493   85718 527.91
+ Proportion_of_apolar_alpha_sphere  1       405   85805 527.99
- Mean_B.factor                      1      4582   90792 528.06
+ polar                              1       113   86098 528.23
+ aromatic                           1       105   86106 528.24
+ small                              1        15   86196 528.32
- Mean_alpha.sphere_radius           1      7003   93214 529.95
- Real_volume                        1   1405963 1492173 729.61

Step:  AIC=525.71
score ~ charged + hydrophobic + Mean_alpha.sphere_radius + Real_volume + 
    Mean_B.factor + Mean_alpha.sphere_SA

                                    Df Sum of Sq     RSS    AIC
&lt;none&gt;                                             87887 525.71
- Mean_alpha.sphere_SA               1      2636   90524 525.84
- hydrophobic                        1      2700   90587 525.89
+ aliphatic                          1      1677   86211 526.33
- charged                            1      3582   91469 526.59
+ C_ATOM                             1      1003   86885 526.89
- Mean_B.factor                      1      4176   92063 527.06
+ aromatic                           1       521   87367 527.29
+ C_RESIDUES                         1       473   87415 527.33
+ negative                           1       273   87614 527.49
+ positive                           1       273   87614 527.49
+ small                              1       189   87698 527.56
+ tiny                               1       148   87740 527.59
+ polar                              1       103   87785 527.63
+ Proportion_of_apolar_alpha_sphere  1         0   87887 527.71
- Mean_alpha.sphere_radius           1      7422   95310 529.55
- Real_volume                        1   1404611 1492498 727.63</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(slm_stepped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = score ~ charged + hydrophobic + Mean_alpha.sphere_radius + 
    Real_volume + Mean_B.factor + Mean_alpha.sphere_SA, data = train_score)

Residuals:
     Min       1Q   Median       3Q      Max 
-118.179  -21.801    6.118   25.229   96.618 

Coefficients:
                           Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              -3.742e+01  8.277e+01  -0.452   0.6527    
charged                  -8.619e+01  5.296e+01  -1.628   0.1085    
hydrophobic              -6.769e+01  4.790e+01  -1.413   0.1624    
Mean_alpha.sphere_radius  5.674e+01  2.422e+01   2.343   0.0222 *  
Real_volume               2.067e-01  6.413e-03  32.231   &lt;2e-16 ***
Mean_B.factor            -6.366e+01  3.623e+01  -1.757   0.0836 .  
Mean_alpha.sphere_SA     -2.241e+02  1.605e+02  -1.396   0.1674    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 36.77 on 65 degrees of freedom
Multiple R-squared:  0.945, Adjusted R-squared:  0.9399 
F-statistic: 186.1 on 6 and 65 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(slm_original_res, <span class="at">breaks =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(slm_stepped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-6-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-6-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Nous pouvons voir deux lignes horizontales à -100 et 100 ce qui signifie que les variances sont égales et on est dans le cas d’homoscédasticité</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>spred_train <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(slm_original, <span class="at">newdata =</span> train.dtf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(slm_original, newdata = train.dtf): prediction from
rank-deficient fit; attr(*, "non-estim") has doubtful cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>spred_test <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(slm_original, <span class="at">newdata =</span> test.dtf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(slm_original, newdata = test.dtf): prediction from
rank-deficient fit; attr(*, "non-estim") has doubtful cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spred_train, train.dtf<span class="sc">$</span>score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spred_test, test.dtf<span class="sc">$</span>score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>sperf_train_lm <span class="ot">&lt;-</span> <span class="fu">postResample</span>(spred_train, train.dtf<span class="sc">$</span>score)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>sperf_test_lm <span class="ot">&lt;-</span> <span class="fu">postResample</span>(spred_test, test.dtf<span class="sc">$</span>score)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>sperf_train_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      RMSE   Rsquared        MAE 
33.8074404  0.9484854 26.0540532 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sperf_test_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      RMSE   Rsquared        MAE 
47.6112194  0.9435464 35.8992548 </code></pre>
</div>
</div>
</section>
</section>
<section id="regression-logistique-multiple" class="level1">
<h1>Regression logistique multiple</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>train_drugg <span class="ot">&lt;-</span> train.dtf[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(train.dtf)<span class="sc">==</span><span class="st">"score"</span>)]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>train_drugg<span class="sc">$</span>drugg <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train_drugg<span class="sc">$</span>drugg)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>glm_original <span class="ot">&lt;-</span> <span class="fu">glm</span>(drugg<span class="sc">~</span>., <span class="at">data =</span> train_drugg, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>glm_stepped <span class="ot">&lt;-</span> <span class="fu">step</span>(glm_original, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=64.9
drugg ~ aromatic + polar + aliphatic + charged + negative + positive + 
    hydrophobic + small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + 
    Mean_alpha.sphere_SA


Step:  AIC=64.9
drugg ~ aromatic + polar + aliphatic + charged + negative + hydrophobic + 
    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + 
    Mean_alpha.sphere_SA

                                    Df Deviance    AIC
- Mean_alpha.sphere_SA               1   32.896 62.896
- negative                           1   32.898 62.898
- C_RESIDUES                         1   32.904 62.904
- tiny                               1   33.079 63.079
- C_ATOM                             1   33.400 63.400
- Mean_alpha.sphere_radius           1   33.413 63.413
- small                              1   33.452 63.452
- aromatic                           1   33.565 63.565
- polar                              1   34.054 64.054
- charged                            1   34.702 64.702
- Real_volume                        1   34.862 64.862
&lt;none&gt;                                   32.896 64.896
- Proportion_of_apolar_alpha_sphere  1   36.164 66.164
- hydrophobic                        1   36.389 66.389
- Mean_B.factor                      1   37.928 67.928
- aliphatic                          1   38.023 68.023

Step:  AIC=62.9
drugg ~ aromatic + polar + aliphatic + charged + negative + hydrophobic + 
    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor

                                    Df Deviance    AIC
- negative                           1   32.899 60.899
- C_RESIDUES                         1   32.905 60.905
- tiny                               1   33.079 61.079
- small                              1   33.507 61.507
- aromatic                           1   33.591 61.591
- C_ATOM                             1   33.597 61.597
- Mean_alpha.sphere_radius           1   33.738 61.738
- polar                              1   34.200 62.200
- charged                            1   34.820 62.820
&lt;none&gt;                                   32.896 62.896
- Real_volume                        1   35.005 63.005
- Proportion_of_apolar_alpha_sphere  1   36.166 64.166
- hydrophobic                        1   36.448 64.448
+ Mean_alpha.sphere_SA               1   32.896 64.896
- Mean_B.factor                      1   38.013 66.013
- aliphatic                          1   38.344 66.344

Step:  AIC=60.9
drugg ~ aromatic + polar + aliphatic + charged + hydrophobic + 
    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor

                                    Df Deviance    AIC
- C_RESIDUES                         1   32.910 58.910
- tiny                               1   33.098 59.098
- aromatic                           1   33.598 59.598
- C_ATOM                             1   33.689 59.689
- Mean_alpha.sphere_radius           1   33.810 59.810
- small                              1   33.858 59.858
- polar                              1   34.425 60.425
&lt;none&gt;                                   32.899 60.899
- Real_volume                        1   35.174 61.174
- charged                            1   36.373 62.373
- Proportion_of_apolar_alpha_sphere  1   36.452 62.452
- hydrophobic                        1   36.722 62.722
+ negative                           1   32.896 62.896
+ positive                           1   32.896 62.896
+ Mean_alpha.sphere_SA               1   32.898 62.898
- Mean_B.factor                      1   38.030 64.030
- aliphatic                          1   38.370 64.370

Step:  AIC=58.91
drugg ~ aromatic + polar + aliphatic + charged + hydrophobic + 
    small + tiny + C_ATOM + Mean_alpha.sphere_radius + Real_volume + 
    Proportion_of_apolar_alpha_sphere + Mean_B.factor

                                    Df Deviance    AIC
- tiny                               1   33.100 57.100
- aromatic                           1   33.598 57.598
- Mean_alpha.sphere_radius           1   33.817 57.817
- small                              1   33.859 57.859
- polar                              1   34.441 58.441
- C_ATOM                             1   34.460 58.460
&lt;none&gt;                                   32.910 58.910
- Real_volume                        1   35.191 59.191
- charged                            1   36.380 60.380
- Proportion_of_apolar_alpha_sphere  1   36.628 60.628
- hydrophobic                        1   36.745 60.745
+ C_RESIDUES                         1   32.899 60.899
+ positive                           1   32.905 60.905
+ negative                           1   32.905 60.905
+ Mean_alpha.sphere_SA               1   32.910 60.910
- Mean_B.factor                      1   38.589 62.589
- aliphatic                          1   39.150 63.150

Step:  AIC=57.1
drugg ~ aromatic + polar + aliphatic + charged + hydrophobic + 
    small + C_ATOM + Mean_alpha.sphere_radius + Real_volume + 
    Proportion_of_apolar_alpha_sphere + Mean_B.factor

                                    Df Deviance    AIC
- aromatic                           1   33.608 55.608
- Mean_alpha.sphere_radius           1   33.868 55.868
- small                              1   34.530 56.530
- C_ATOM                             1   34.567 56.567
- polar                              1   34.656 56.656
&lt;none&gt;                                   33.100 57.100
- Real_volume                        1   35.325 57.325
- charged                            1   36.380 58.380
- Proportion_of_apolar_alpha_sphere  1   36.703 58.703
- hydrophobic                        1   36.803 58.803
+ tiny                               1   32.910 58.910
+ negative                           1   33.079 59.079
+ positive                           1   33.079 59.079
+ C_RESIDUES                         1   33.098 59.098
+ Mean_alpha.sphere_SA               1   33.100 59.100
- Mean_B.factor                      1   38.599 60.599
- aliphatic                          1   44.497 66.497

Step:  AIC=55.61
drugg ~ polar + aliphatic + charged + hydrophobic + small + C_ATOM + 
    Mean_alpha.sphere_radius + Real_volume + Proportion_of_apolar_alpha_sphere + 
    Mean_B.factor

                                    Df Deviance    AIC
- Mean_alpha.sphere_radius           1   34.054 54.054
- small                              1   34.553 54.553
- polar                              1   34.659 54.659
- C_ATOM                             1   34.851 54.851
- Real_volume                        1   35.590 55.590
&lt;none&gt;                                   33.608 55.608
- charged                            1   36.588 56.588
- Proportion_of_apolar_alpha_sphere  1   36.818 56.818
- hydrophobic                        1   36.839 56.839
+ aromatic                           1   33.100 57.100
+ Mean_alpha.sphere_SA               1   33.585 57.585
+ tiny                               1   33.598 57.598
+ C_RESIDUES                         1   33.606 57.606
+ positive                           1   33.608 57.608
+ negative                           1   33.608 57.608
- Mean_B.factor                      1   38.671 58.671
- aliphatic                          1   45.487 65.487

Step:  AIC=54.05
drugg ~ polar + aliphatic + charged + hydrophobic + small + C_ATOM + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor

                                    Df Deviance    AIC
- small                              1   34.621 52.621
- polar                              1   35.115 53.115
- C_ATOM                             1   35.132 53.132
&lt;none&gt;                                   34.054 54.054
- Real_volume                        1   36.672 54.672
- charged                            1   36.694 54.694
- hydrophobic                        1   37.146 55.146
+ Mean_alpha.sphere_radius           1   33.608 55.608
- Proportion_of_apolar_alpha_sphere  1   37.756 55.756
+ aromatic                           1   33.868 55.868
+ Mean_alpha.sphere_SA               1   33.965 55.965
+ negative                           1   34.027 56.027
+ positive                           1   34.027 56.027
+ tiny                               1   34.051 56.051
+ C_RESIDUES                         1   34.053 56.053
- Mean_B.factor                      1   38.683 56.683
- aliphatic                          1   45.538 63.538

Step:  AIC=52.62
drugg ~ polar + aliphatic + charged + hydrophobic + C_ATOM + 
    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor

                                    Df Deviance    AIC
- C_ATOM                             1   36.158 52.158
- polar                              1   36.395 52.395
&lt;none&gt;                                   34.621 52.621
- charged                            1   36.694 52.694
- Real_volume                        1   37.561 53.561
+ small                              1   34.054 54.054
- hydrophobic                        1   38.368 54.368
+ tiny                               1   34.394 54.394
+ positive                           1   34.505 54.505
+ negative                           1   34.505 54.505
+ Mean_alpha.sphere_SA               1   34.544 54.544
+ Mean_alpha.sphere_radius           1   34.553 54.553
+ C_RESIDUES                         1   34.593 54.593
+ aromatic                           1   34.612 54.612
- Mean_B.factor                      1   38.986 54.986
- Proportion_of_apolar_alpha_sphere  1   41.255 57.255
- aliphatic                          1   46.672 62.672

Step:  AIC=52.16
drugg ~ polar + aliphatic + charged + hydrophobic + Real_volume + 
    Proportion_of_apolar_alpha_sphere + Mean_B.factor

                                    Df Deviance    AIC
&lt;none&gt;                                   36.158 52.158
- Real_volume                        1   38.317 52.317
+ C_ATOM                             1   34.621 52.621
+ C_RESIDUES                         1   34.713 52.713
- charged                            1   38.804 52.804
- polar                              1   38.863 52.863
+ small                              1   35.132 53.132
+ Mean_alpha.sphere_radius           1   35.343 53.343
- Mean_B.factor                      1   39.461 53.461
+ tiny                               1   35.596 53.596
+ Mean_alpha.sphere_SA               1   35.879 53.879
+ aromatic                           1   36.092 54.092
+ negative                           1   36.103 54.103
+ positive                           1   36.103 54.103
- hydrophobic                        1   40.960 54.960
- Proportion_of_apolar_alpha_sphere  1   42.597 56.597
- aliphatic                          1   48.568 62.568</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(glm_original<span class="sc">$</span>fitted.values, train_drugg<span class="sc">$</span>drugg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>glm_ori_res <span class="ot">&lt;-</span> glm_original<span class="sc">$</span>residuals</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>glm_stp_res <span class="ot">&lt;-</span> glm_stepped<span class="sc">$</span>residuals</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(glm_ori_res, <span class="at">breaks =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(glm_stp_res, <span class="at">breaks =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(glm_ori_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(glm_stp_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dtf_train_clean <span class="ot">&lt;-</span> train.dtf[, <span class="fu">which</span>(<span class="sc">!</span><span class="fu">colnames</span>(dtf_new) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"C_RESIDUES"</span>, <span class="st">"positive"</span>, <span class="st">"Real_volume"</span>))]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(clean_dtf)<span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  glm_tmp <span class="ot">&lt;-</span> <span class="fu">glm</span>(dtf_train_clean<span class="sc">$</span>drugg<span class="sc">~</span>dtf_train_clean[, i], <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  summary_model <span class="ot">&lt;-</span> <span class="fu">summary</span>(glm_tmp)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> summary_model<span class="sc">$</span>coefficients[, <span class="st">"Pr(&gt;|z|)"</span>][<span class="dv">2</span>]</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(p_values, p_value)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(p_values) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(dtf_train_clean)[<span class="dv">2</span><span class="sc">:</span><span class="dv">14</span>]</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>val_desc <span class="ot">&lt;-</span> <span class="fu">names</span>(p_values[<span class="fu">which</span>(p_values<span class="sc">&lt;</span><span class="fl">0.05</span>)])</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>dtf_train_final <span class="ot">&lt;-</span> train_log[<span class="fu">c</span>(<span class="st">"drugg"</span>, val_desc)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons voir deux lignes horizontales à -100 et 100 ce qui signifie que les variances sont égales et on est dans le cas d’homoscédasticité</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dpred_train_logi <span class="ot">&lt;-</span> <span class="fu">predict.glm</span>(glm_stepped, <span class="at">newdata =</span> train.dtf, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>dpred_test_logi <span class="ot">&lt;-</span> <span class="fu">predict.glm</span>(glm_stepped, <span class="at">newdata =</span> test.dtf, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>dpred_train_logi_round <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">round</span>(dpred_train_logi))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>dpred_test_logi_round <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">round</span>(dpred_test_logi))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dpred_train_logi, train.dtf<span class="sc">$</span>drugg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dpred_test_logi, test.dtf<span class="sc">$</span>drugg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tp3_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(dpred_train_logi_round, train.dtf<span class="sc">$</span>drugg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 20  4
         1  5 43
                                          
               Accuracy : 0.875           
                 95% CI : (0.7759, 0.9412)
    No Information Rate : 0.6528          
    P-Value [Acc &gt; NIR] : 1.79e-05        
                                          
                  Kappa : 0.7216          
                                          
 Mcnemar's Test P-Value : 1               
                                          
            Sensitivity : 0.8000          
            Specificity : 0.9149          
         Pos Pred Value : 0.8333          
         Neg Pred Value : 0.8958          
             Prevalence : 0.3472          
         Detection Rate : 0.2778          
   Detection Prevalence : 0.3333          
      Balanced Accuracy : 0.8574          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(dpred_test_logi_round, test.dtf<span class="sc">$</span>drugg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 11  4
         1  3 19
                                          
               Accuracy : 0.8108          
                 95% CI : (0.6484, 0.9204)
    No Information Rate : 0.6216          
    P-Value [Acc &gt; NIR] : 0.01111         
                                          
                  Kappa : 0.6034          
                                          
 Mcnemar's Test P-Value : 1.00000         
                                          
            Sensitivity : 0.7857          
            Specificity : 0.8261          
         Pos Pred Value : 0.7333          
         Neg Pred Value : 0.8636          
             Prevalence : 0.3784          
         Detection Rate : 0.2973          
   Detection Prevalence : 0.4054          
      Balanced Accuracy : 0.8059          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>roc_curve_test <span class="ot">&lt;-</span> <span class="fu">roc</span>(test.dtf<span class="sc">$</span>drugg, pred_test_logi)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_curve_test)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_curve_test), <span class="dv">2</span>)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>roc_curve_train <span class="ot">&lt;-</span> <span class="fu">roc</span>(train.dtf<span class="sc">$</span>drugg, pred_train_logi)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_curve_train)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_curve_train), <span class="dv">2</span>)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb49" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TP3"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Martin Bari Garnier"</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-01-15"</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu"># Régression linéaire sur les données initiales, non nettoyées</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/X.Rdata"</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/Y.Rdata"</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/train.dtf.Rdata"</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/test.dtf.Rdata"</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>train_score <span class="ot">&lt;-</span> train.dtf[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(train.dtf)<span class="sc">==</span><span class="st">"drugg"</span>)]</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>lm_score <span class="ot">&lt;-</span> <span class="fu">lm</span>(score<span class="sc">~</span>., <span class="at">data =</span> train_score)</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_score)</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm_score)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(lm_score$fitted.values, dtf_new$score)</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>Nous avons un modèle avec un R-carré ajusté à 0.9392 donc notre modèle est très performant. Il faut cependant avoir en tête que les données n'ont pas été normalisées. En effet, Real_volume prend toute la variabilité du fait de son ordre de grandeur bien supérieur aux autres descripteurs. Nous voyons aussi qu'il y a un descripteur avec des coefficients NA ce qui indique une corrélation ou une colinéarité avec un ou plusieurs autres descripteurs.</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="fu"># Calcul du modèle de régression linéaire multiple</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Préparation du jeu de données</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>A l'aide d'un <span class="in">`summary()`</span>, nous avons vu qu'il n'y avait pas de NA dans notre jeu de données. Nous devons enlever les valeurs manquantes car la régression effectuée requiert une matrice complète. D'autres méthodes par inférence existent afin de remplacer des valeurs manquantes mais par définition elles dénaturent la qualité des résultats. Pour ne pas prendre ne compte les valeurs manquantes, nous pouvons modifier le df en utilisant na.omit() ou nous pouvons effectuer la régression multiple sans prendre en compte les colonnes ou lignes contenant les valeurs manquantes.</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Etude de l'autocorrélation</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Création de la matrice de corrélation</span></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>cor_x <span class="ot">&lt;-</span> <span class="fu">cor</span>(X)</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap</span></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(cor_x)</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Mise en évidence des descripteurs corrélés et colinéaires</span></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a><span class="fu">findCorrelation</span>(cor_x)</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="fu">findLinearCombos</span>(cor_x)</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X[, <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">13</span>)])</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>Nous avons choisi un seuil de corrélation de 0,9 correspondant à la valeur par défaut car elle nous permet de retirer uniquement deux colonnes. Nous voulons garder un jeu de descripteurs large et varié.</span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>Cette fonction nous indique que les colonnes 6, 4, 5 sont colinéaires. Elle nous conseille de retirer la colonne 6. </span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sélection des descripteurs pertinents</span></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>Nous réalisons une régression linéaire pour chaque descripteur en fonction du score.</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=F}</span></span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a><span class="in">clean_train_score &lt;- train_score[, which(!colnames(train_score) %in% c("C_RESIDUES", "positive", "Real_volume"))]</span></span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a><span class="in">p_values &lt;- NULL</span></span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:(length(clean_train_score)-1)) {</span></span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a><span class="in">  lm_tmp &lt;- lm(clean_train_score$score~clean_train_score[, i])</span></span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a><span class="in">  summary_model &lt;- summary(lm_tmp)</span></span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a><span class="in">  p_value &lt;- summary_model$coefficients[, "Pr(&gt;|t|)"][2]</span></span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a><span class="in">  p_values &lt;- c(p_values, p_value)</span></span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a><span class="in">names(p_values) &lt;- colnames(clean_train_score)[2:14]</span></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a><span class="in">val_desc &lt;- names(p_values[which(p_values&lt;0.2)])</span></span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a><span class="in">dtf_final &lt;- dtf_new[c("score", val_desc)]</span></span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a><span class="fu">## Etablissement du modèle</span></span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## Réalisation du step</span></span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a>slm_original <span class="ot">&lt;-</span> <span class="fu">lm</span>(score<span class="sc">~</span>., <span class="at">data =</span> train_score)</span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a>slm_original_res <span class="ot">&lt;-</span> slm_original<span class="sc">$</span>residuals</span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a>slm_stepped <span class="ot">&lt;-</span> <span class="fu">step</span>(slm_original, <span class="at">direction =</span> <span class="st">"both"</span>)</span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(slm_stepped)</span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(slm_original_res, <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(slm_stepped)</span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a>Nous pouvons voir deux lignes horizontales à -100 et 100 ce qui signifie que les variances sont égales et on est dans le cas d'homoscédasticité</span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true" tabindex="-1"></a>spred_train <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(slm_original, <span class="at">newdata =</span> train.dtf)</span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a>spred_test <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(slm_original, <span class="at">newdata =</span> test.dtf)</span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spred_train, train.dtf<span class="sc">$</span>score)</span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spred_test, test.dtf<span class="sc">$</span>score)</span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-111"><a href="#cb49-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-112"><a href="#cb49-112" aria-hidden="true" tabindex="-1"></a>sperf_train_lm <span class="ot">&lt;-</span> <span class="fu">postResample</span>(spred_train, train.dtf<span class="sc">$</span>score)</span>
<span id="cb49-113"><a href="#cb49-113" aria-hidden="true" tabindex="-1"></a>sperf_test_lm <span class="ot">&lt;-</span> <span class="fu">postResample</span>(spred_test, test.dtf<span class="sc">$</span>score)</span>
<span id="cb49-114"><a href="#cb49-114" aria-hidden="true" tabindex="-1"></a>sperf_train_lm</span>
<span id="cb49-115"><a href="#cb49-115" aria-hidden="true" tabindex="-1"></a>sperf_test_lm</span>
<span id="cb49-116"><a href="#cb49-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-117"><a href="#cb49-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-118"><a href="#cb49-118" aria-hidden="true" tabindex="-1"></a><span class="fu"># Regression logistique multiple</span></span>
<span id="cb49-119"><a href="#cb49-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-122"><a href="#cb49-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-123"><a href="#cb49-123" aria-hidden="true" tabindex="-1"></a>train_drugg <span class="ot">&lt;-</span> train.dtf[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(train.dtf)<span class="sc">==</span><span class="st">"score"</span>)]</span>
<span id="cb49-124"><a href="#cb49-124" aria-hidden="true" tabindex="-1"></a>train_drugg<span class="sc">$</span>drugg <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train_drugg<span class="sc">$</span>drugg)</span>
<span id="cb49-125"><a href="#cb49-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-126"><a href="#cb49-126" aria-hidden="true" tabindex="-1"></a>glm_original <span class="ot">&lt;-</span> <span class="fu">glm</span>(drugg<span class="sc">~</span>., <span class="at">data =</span> train_drugg, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb49-127"><a href="#cb49-127" aria-hidden="true" tabindex="-1"></a>glm_stepped <span class="ot">&lt;-</span> <span class="fu">step</span>(glm_original, <span class="at">direction =</span> <span class="st">"both"</span>)</span>
<span id="cb49-128"><a href="#cb49-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-129"><a href="#cb49-129" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(glm_original<span class="sc">$</span>fitted.values, train_drugg<span class="sc">$</span>drugg)</span>
<span id="cb49-130"><a href="#cb49-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-131"><a href="#cb49-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-134"><a href="#cb49-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-135"><a href="#cb49-135" aria-hidden="true" tabindex="-1"></a>glm_ori_res <span class="ot">&lt;-</span> glm_original<span class="sc">$</span>residuals</span>
<span id="cb49-136"><a href="#cb49-136" aria-hidden="true" tabindex="-1"></a>glm_stp_res <span class="ot">&lt;-</span> glm_stepped<span class="sc">$</span>residuals</span>
<span id="cb49-137"><a href="#cb49-137" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(glm_ori_res, <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb49-138"><a href="#cb49-138" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(glm_stp_res, <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb49-139"><a href="#cb49-139" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(glm_ori_res)</span>
<span id="cb49-140"><a href="#cb49-140" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(glm_stp_res)</span>
<span id="cb49-141"><a href="#cb49-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-142"><a href="#cb49-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-143"><a href="#cb49-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=F}</span></span>
<span id="cb49-144"><a href="#cb49-144" aria-hidden="true" tabindex="-1"></a><span class="in">dtf_train_clean &lt;- train.dtf[, which(!colnames(dtf_new) %in% c("C_RESIDUES", "positive", "Real_volume"))]</span></span>
<span id="cb49-145"><a href="#cb49-145" aria-hidden="true" tabindex="-1"></a><span class="in">p_values &lt;- NULL</span></span>
<span id="cb49-146"><a href="#cb49-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-147"><a href="#cb49-147" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:(length(clean_dtf)-1)) {</span></span>
<span id="cb49-148"><a href="#cb49-148" aria-hidden="true" tabindex="-1"></a><span class="in">  glm_tmp &lt;- glm(dtf_train_clean$drugg~dtf_train_clean[, i], family = "binomial", maxit = 1000)</span></span>
<span id="cb49-149"><a href="#cb49-149" aria-hidden="true" tabindex="-1"></a><span class="in">  summary_model &lt;- summary(glm_tmp)</span></span>
<span id="cb49-150"><a href="#cb49-150" aria-hidden="true" tabindex="-1"></a><span class="in">  p_value &lt;- summary_model$coefficients[, "Pr(&gt;|z|)"][2]</span></span>
<span id="cb49-151"><a href="#cb49-151" aria-hidden="true" tabindex="-1"></a><span class="in">  p_values &lt;- c(p_values, p_value)</span></span>
<span id="cb49-152"><a href="#cb49-152" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb49-153"><a href="#cb49-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-154"><a href="#cb49-154" aria-hidden="true" tabindex="-1"></a><span class="in">names(p_values) &lt;- colnames(dtf_train_clean)[2:14]</span></span>
<span id="cb49-155"><a href="#cb49-155" aria-hidden="true" tabindex="-1"></a><span class="in">val_desc &lt;- names(p_values[which(p_values&lt;0.05)])</span></span>
<span id="cb49-156"><a href="#cb49-156" aria-hidden="true" tabindex="-1"></a><span class="in">dtf_train_final &lt;- train_log[c("drugg", val_desc)]</span></span>
<span id="cb49-157"><a href="#cb49-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-158"><a href="#cb49-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-159"><a href="#cb49-159" aria-hidden="true" tabindex="-1"></a>Nous pouvons voir deux lignes horizontales à -100 et 100 ce qui signifie que les variances sont égales et on est dans le cas d'homoscédasticité</span>
<span id="cb49-160"><a href="#cb49-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-163"><a href="#cb49-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-164"><a href="#cb49-164" aria-hidden="true" tabindex="-1"></a>dpred_train_logi <span class="ot">&lt;-</span> <span class="fu">predict.glm</span>(glm_stepped, <span class="at">newdata =</span> train.dtf, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb49-165"><a href="#cb49-165" aria-hidden="true" tabindex="-1"></a>dpred_test_logi <span class="ot">&lt;-</span> <span class="fu">predict.glm</span>(glm_stepped, <span class="at">newdata =</span> test.dtf, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb49-166"><a href="#cb49-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-167"><a href="#cb49-167" aria-hidden="true" tabindex="-1"></a>dpred_train_logi_round <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">round</span>(dpred_train_logi))</span>
<span id="cb49-168"><a href="#cb49-168" aria-hidden="true" tabindex="-1"></a>dpred_test_logi_round <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">round</span>(dpred_test_logi))</span>
<span id="cb49-169"><a href="#cb49-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-170"><a href="#cb49-170" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dpred_train_logi, train.dtf<span class="sc">$</span>drugg)</span>
<span id="cb49-171"><a href="#cb49-171" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dpred_test_logi, test.dtf<span class="sc">$</span>drugg)</span>
<span id="cb49-172"><a href="#cb49-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-173"><a href="#cb49-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-176"><a href="#cb49-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-177"><a href="#cb49-177" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(dpred_train_logi_round, train.dtf<span class="sc">$</span>drugg)</span>
<span id="cb49-178"><a href="#cb49-178" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(dpred_test_logi_round, test.dtf<span class="sc">$</span>drugg)</span>
<span id="cb49-179"><a href="#cb49-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-180"><a href="#cb49-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-181"><a href="#cb49-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-182"><a href="#cb49-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=F}</span></span>
<span id="cb49-183"><a href="#cb49-183" aria-hidden="true" tabindex="-1"></a><span class="in">library(pROC)</span></span>
<span id="cb49-184"><a href="#cb49-184" aria-hidden="true" tabindex="-1"></a><span class="in">roc_curve_test &lt;- roc(test.dtf$drugg, pred_test_logi)</span></span>
<span id="cb49-185"><a href="#cb49-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-186"><a href="#cb49-186" aria-hidden="true" tabindex="-1"></a><span class="in">plot(roc_curve_test)</span></span>
<span id="cb49-187"><a href="#cb49-187" aria-hidden="true" tabindex="-1"></a><span class="in">legend("bottomright", legend = paste("AUC = ", round(auc(roc_curve_test), 2)), col = "blue", lty = 1)</span></span>
<span id="cb49-188"><a href="#cb49-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-189"><a href="#cb49-189" aria-hidden="true" tabindex="-1"></a><span class="in">roc_curve_train &lt;- roc(train.dtf$drugg, pred_train_logi)</span></span>
<span id="cb49-190"><a href="#cb49-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-191"><a href="#cb49-191" aria-hidden="true" tabindex="-1"></a><span class="in">plot(roc_curve_train)</span></span>
<span id="cb49-192"><a href="#cb49-192" aria-hidden="true" tabindex="-1"></a><span class="in">legend("bottomright", legend = paste("AUC = ", round(auc(roc_curve_train), 2)), col = "blue", lty = 1)</span></span>
<span id="cb49-193"><a href="#cb49-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-194"><a href="#cb49-194" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>