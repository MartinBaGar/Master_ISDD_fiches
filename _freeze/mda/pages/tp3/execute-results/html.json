{
  "hash": "715a84aa2aca55ee1314135b8d2d7e56",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Linear and Logistic Regression\"\n---\n\n\n# Régression linéaire sur les données initiales, non nettoyées\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(\"../data/X.Rdata\")\nload(\"../data/Y.Rdata\")\nload(\"../data/train.dtf.Rdata\")\nload(\"../data/test.dtf.Rdata\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_score <- train.dtf[, -which(colnames(train.dtf)==\"drugg\")]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(caret)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: ggplot2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: lattice\n```\n\n\n:::\n\n```{.r .cell-code}\nlm_score <- lm(score~., data = train_score)\nsummary(lm_score)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = score ~ ., data = train_score)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-106.08  -21.10    2.80   21.39   93.09 \n\nCoefficients: (1 not defined because of singularities)\n                                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                        -77.74671  154.75161  -0.502   0.6174    \naromatic                             7.14923   81.80382   0.087   0.9307    \npolar                               11.97115   69.71791   0.172   0.8643    \naliphatic                          111.34361   82.29585   1.353   0.1815    \ncharged                            -76.68689  105.91847  -0.724   0.4721    \nnegative                           -17.76245  120.01168  -0.148   0.8829    \npositive                                  NA         NA      NA       NA    \nhydrophobic                       -124.73217   80.54730  -1.549   0.1271    \nsmall                              -36.48391   70.13055  -0.520   0.6050    \ntiny                                80.08128   77.04033   1.039   0.3031    \nC_ATOM                               0.44659    0.59816   0.747   0.4584    \nC_RESIDUES                          -0.74231    1.56561  -0.474   0.6372    \nMean_alpha.sphere_radius            73.90467   37.38355   1.977   0.0530 .  \nReal_volume                          0.19245    0.02564   7.505 5.07e-10 ***\nProportion_of_apolar_alpha_sphere  -32.00992   47.84819  -0.669   0.5063    \nMean_B.factor                      -75.21093   41.35019  -1.819   0.0743 .  \nMean_alpha.sphere_SA              -229.92250  196.10652  -1.172   0.2460    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 38.33 on 56 degrees of freedom\nMultiple R-squared:  0.9485,\tAdjusted R-squared:  0.9347 \nF-statistic: 68.74 on 15 and 56 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(lm_score)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-3-4.png){width=672}\n:::\n\n```{.r .cell-code}\n# plot(lm_score$fitted.values, dtf_new$score)\n```\n:::\n\nNous avons un modèle avec un R-carré ajusté à 0.9392 donc notre modèle est très performant. Il faut cependant avoir en tête que les données n'ont pas été normalisées. En effet, Real_volume prend toute la variabilité du fait de son ordre de grandeur bien supérieur aux autres descripteurs. Nous voyons aussi qu'il y a un descripteur avec des coefficients NA ce qui indique une corrélation ou une colinéarité avec un ou plusieurs autres descripteurs.\n\n# Calcul du modèle de régression linéaire multiple\n\n## Préparation du jeu de données\n\nA l'aide d'un `summary()`, nous avons vu qu'il n'y avait pas de NA dans notre jeu de données. Nous devons enlever les valeurs manquantes car la régression effectuée requiert une matrice complète. D'autres méthodes par inférence existent afin de remplacer des valeurs manquantes mais par définition elles dénaturent la qualité des résultats. Pour ne pas prendre ne compte les valeurs manquantes, nous pouvons modifier le df en utilisant na.omit() ou nous pouvons effectuer la régression multiple sans prendre en compte les colonnes ou lignes contenant les valeurs manquantes.\n\n## Etude de l'autocorrélation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Création de la matrice de corrélation\ncor_x <- cor(X)\n\n# Heatmap\nheatmap(cor_x)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Mise en évidence des descripteurs corrélés et colinéaires\nfindCorrelation(cor_x)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 11 13\n```\n\n\n:::\n\n```{.r .cell-code}\nfindLinearCombos(cor_x)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$linearCombos\n$linearCombos[[1]]\n[1] 6 4 5\n\n\n$remove\n[1] 6\n```\n\n\n:::\n\n```{.r .cell-code}\ncolnames(X[, c(6, 11, 13)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"positive\"    \"C_RESIDUES\"  \"Real_volume\"\n```\n\n\n:::\n:::\n\nNous avons choisi un seuil de corrélation de 0,9 correspondant à la valeur par défaut car elle nous permet de retirer uniquement deux colonnes. Nous voulons garder un jeu de descripteurs large et varié.\nCette fonction nous indique que les colonnes 6, 4, 5 sont colinéaires. Elle nous conseille de retirer la colonne 6. \n\n## Sélection des descripteurs pertinents\n\nNous réalisons une régression linéaire pour chaque descripteur en fonction du score.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_train_score <- train_score[, which(!colnames(train_score) %in% c(\"C_RESIDUES\", \"positive\", \"Real_volume\"))]\np_values <- NULL\n\nfor (i in 1:(length(clean_train_score)-1)) {\n  lm_tmp <- lm(clean_train_score$score~clean_train_score[, i])\n  summary_model <- summary(lm_tmp)\n  p_value <- summary_model$coefficients[, \"Pr(>|t|)\"][2]\n  p_values <- c(p_values, p_value)\n}\n\nnames(p_values) <- colnames(clean_train_score)[2:14]\nval_desc <- names(p_values[which(p_values<0.2)])\ndtf_final <- dtf_new[c(\"score\", val_desc)]\n```\n:::\n\n\n## Etablissement du modèle\n\n## Réalisation du step\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslm_original <- lm(score~., data = train_score)\nslm_original_res <- slm_original$residuals\nslm_stepped <- step(slm_original, direction = \"both\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStart:  AIC=538.98\nscore ~ aromatic + polar + aliphatic + charged + negative + positive + \n    hydrophobic + small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + \n    Mean_alpha.sphere_SA\n\n\nStep:  AIC=538.98\nscore ~ aromatic + polar + aliphatic + charged + negative + hydrophobic + \n    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + \n    Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq    RSS    AIC\n- aromatic                           1        11  82303 536.99\n- negative                           1        32  82324 537.01\n- polar                              1        43  82335 537.02\n- C_RESIDUES                         1       330  82622 537.27\n- small                              1       398  82690 537.33\n- Proportion_of_apolar_alpha_sphere  1       658  82950 537.55\n- charged                            1       770  83062 537.65\n- C_ATOM                             1       819  83111 537.69\n- tiny                               1      1588  83880 538.35\n- Mean_alpha.sphere_SA               1      2020  84312 538.72\n<none>                                            82292 538.98\n- aliphatic                          1      2690  84982 539.29\n- hydrophobic                        1      3524  85816 540.00\n- Mean_B.factor                      1      4862  87153 541.11\n- Mean_alpha.sphere_radius           1      5743  88035 541.84\n- Real_volume                        1     82760 165052 587.09\n\nStep:  AIC=536.99\nscore ~ polar + aliphatic + charged + negative + hydrophobic + \n    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + \n    Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq    RSS    AIC\n- negative                           1        28  82332 535.01\n- polar                              1        72  82375 535.05\n- C_RESIDUES                         1       335  82638 535.28\n- small                              1       524  82827 535.44\n- Proportion_of_apolar_alpha_sphere  1       649  82952 535.55\n- C_ATOM                             1       810  83113 535.69\n- charged                            1       897  83200 535.77\n- tiny                               1      1677  83980 536.44\n- Mean_alpha.sphere_SA               1      2021  84324 536.73\n<none>                                            82303 536.99\n- aliphatic                          1      3358  85661 537.87\n- hydrophobic                        1      4610  86913 538.91\n+ aromatic                           1        11  82292 538.98\n- Mean_B.factor                      1      5214  87517 539.41\n- Mean_alpha.sphere_radius           1      5940  88243 540.00\n- Real_volume                        1     84993 167296 586.06\n\nStep:  AIC=535.01\nscore ~ polar + aliphatic + charged + hydrophobic + small + tiny + \n    C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + Real_volume + \n    Proportion_of_apolar_alpha_sphere + Mean_B.factor + Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq    RSS    AIC\n- polar                              1       129  82461 533.13\n- C_RESIDUES                         1       311  82643 533.28\n- C_ATOM                             1       788  83119 533.70\n- Proportion_of_apolar_alpha_sphere  1       841  83173 533.74\n- small                              1       948  83279 533.84\n- Mean_alpha.sphere_SA               1      1996  84327 534.74\n- tiny                               1      2244  84575 534.95\n<none>                                            82332 535.01\n- charged                            1      2374  84706 535.06\n- aliphatic                          1      3585  85917 536.08\n+ negative                           1        28  82303 536.99\n+ positive                           1        28  82303 536.99\n+ aromatic                           1         7  82324 537.01\n- hydrophobic                        1      4927  87258 537.20\n- Mean_B.factor                      1      5195  87527 537.42\n- Mean_alpha.sphere_radius           1      6125  88456 538.18\n- Real_volume                        1     94755 177086 588.16\n\nStep:  AIC=533.13\nscore ~ aliphatic + charged + hydrophobic + small + tiny + C_ATOM + \n    C_RESIDUES + Mean_alpha.sphere_radius + Real_volume + Proportion_of_apolar_alpha_sphere + \n    Mean_B.factor + Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq    RSS    AIC\n- C_RESIDUES                         1       311  82772 531.40\n- C_ATOM                             1       755  83216 531.78\n- Proportion_of_apolar_alpha_sphere  1       899  83360 531.91\n- small                              1      1103  83564 532.08\n- Mean_alpha.sphere_SA               1      1949  84410 532.81\n- tiny                               1      2236  84697 533.05\n- charged                            1      2322  84783 533.13\n<none>                                            82461 533.13\n- aliphatic                          1      3682  86143 534.27\n+ polar                              1       129  82332 535.01\n+ negative                           1        86  82375 535.05\n+ positive                           1        86  82375 535.05\n+ aromatic                           1        45  82416 535.09\n- Mean_B.factor                      1      5181  87642 535.51\n- Mean_alpha.sphere_radius           1      6005  88466 536.19\n- hydrophobic                        1      6063  88524 536.23\n- Real_volume                        1     97115 179576 587.16\n\nStep:  AIC=531.4\nscore ~ aliphatic + charged + hydrophobic + small + tiny + C_ATOM + \n    Mean_alpha.sphere_radius + Real_volume + Proportion_of_apolar_alpha_sphere + \n    Mean_B.factor + Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq    RSS    AIC\n- C_ATOM                             1       524  83296 529.85\n- Proportion_of_apolar_alpha_sphere  1       688  83460 529.99\n- small                              1      1229  84002 530.46\n- Mean_alpha.sphere_SA               1      1638  84410 530.81\n- tiny                               1      1998  84771 531.11\n- charged                            1      2293  85065 531.36\n<none>                                            82772 531.40\n- aliphatic                          1      3412  86185 532.31\n+ C_RESIDUES                         1       311  82461 533.13\n+ polar                              1       130  82643 533.28\n+ aromatic                           1        57  82716 533.35\n+ negative                           1        41  82732 533.36\n+ positive                           1        41  82732 533.36\n- Mean_B.factor                      1      4869  87642 533.51\n- Mean_alpha.sphere_radius           1      5699  88472 534.19\n- hydrophobic                        1      5990  88762 534.43\n- Real_volume                        1     96959 179731 585.22\n\nStep:  AIC=529.85\nscore ~ aliphatic + charged + hydrophobic + small + tiny + Mean_alpha.sphere_radius + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + \n    Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq     RSS    AIC\n- Proportion_of_apolar_alpha_sphere  1       790   84086 528.53\n- Mean_alpha.sphere_SA               1      1452   84748 529.10\n- small                              1      1627   84923 529.24\n- tiny                               1      2238   85534 529.76\n<none>                                             83296 529.85\n- charged                            1      2497   85794 529.98\n- aliphatic                          1      3637   86933 530.93\n+ C_ATOM                             1       524   82772 531.40\n+ polar                              1        82   83214 531.78\n+ C_RESIDUES                         1        81   83216 531.78\n+ aromatic                           1        12   83284 531.84\n+ negative                           1         0   83296 531.85\n+ positive                           1         0   83296 531.85\n- Mean_B.factor                      1      5075   88371 532.11\n- hydrophobic                        1      6002   89298 532.86\n- Mean_alpha.sphere_radius           1      6597   89893 533.34\n- Real_volume                        1   1335762 1419058 732.00\n\nStep:  AIC=528.53\nscore ~ aliphatic + charged + hydrophobic + small + tiny + Mean_alpha.sphere_radius + \n    Real_volume + Mean_B.factor + Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq     RSS    AIC\n- small                              1       960   85046 527.35\n- Mean_alpha.sphere_SA               1      1081   85167 527.45\n- charged                            1      1867   85953 528.11\n- tiny                               1      2110   86196 528.32\n<none>                                             84086 528.53\n- aliphatic                          1      2877   86963 528.95\n+ Proportion_of_apolar_alpha_sphere  1       790   83296 529.85\n+ C_ATOM                             1       626   83460 529.99\n- Mean_B.factor                      1      4428   88514 530.23\n+ C_RESIDUES                         1       220   83866 530.34\n+ polar                              1       122   83964 530.43\n+ negative                           1       108   83978 530.44\n+ positive                           1       108   83978 530.44\n+ aromatic                           1         0   84086 530.53\n- hydrophobic                        1      5820   89906 531.35\n- Mean_alpha.sphere_radius           1      6384   90470 531.80\n- Real_volume                        1   1355876 1439962 731.05\n\nStep:  AIC=527.35\nscore ~ aliphatic + charged + hydrophobic + tiny + Mean_alpha.sphere_radius + \n    Real_volume + Mean_B.factor + Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq     RSS    AIC\n- tiny                               1      1164   86211 526.33\n- Mean_alpha.sphere_SA               1      1347   86394 526.48\n- charged                            1      1463   86509 526.58\n<none>                                             85046 527.35\n- aliphatic                          1      2694   87740 527.59\n+ small                              1       960   84086 528.53\n+ C_ATOM                             1       912   84134 528.57\n+ negative                           1       485   84561 528.94\n+ positive                           1       485   84561 528.94\n+ polar                              1       231   84815 529.15\n+ C_RESIDUES                         1       231   84816 529.15\n+ aromatic                           1       220   84826 529.16\n- Mean_B.factor                      1      4672   89718 529.20\n+ Proportion_of_apolar_alpha_sphere  1       124   84923 529.24\n- hydrophobic                        1      4865   89912 529.35\n- Mean_alpha.sphere_radius           1      6723   91769 530.83\n- Real_volume                        1   1387743 1472790 730.67\n\nStep:  AIC=526.33\nscore ~ aliphatic + charged + hydrophobic + Mean_alpha.sphere_radius + \n    Real_volume + Mean_B.factor + Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq     RSS    AIC\n- aliphatic                          1      1677   87887 525.71\n- Mean_alpha.sphere_SA               1      1929   88140 525.92\n<none>                                             86211 526.33\n- charged                            1      3014   89224 526.80\n+ tiny                               1      1164   85046 527.35\n+ C_ATOM                             1       880   85330 527.59\n- hydrophobic                        1      4172   90383 527.73\n+ negative                           1       659   85551 527.77\n+ positive                           1       659   85551 527.77\n+ C_RESIDUES                         1       493   85718 527.91\n+ Proportion_of_apolar_alpha_sphere  1       405   85805 527.99\n- Mean_B.factor                      1      4582   90792 528.06\n+ polar                              1       113   86098 528.23\n+ aromatic                           1       105   86106 528.24\n+ small                              1        15   86196 528.32\n- Mean_alpha.sphere_radius           1      7003   93214 529.95\n- Real_volume                        1   1405963 1492173 729.61\n\nStep:  AIC=525.71\nscore ~ charged + hydrophobic + Mean_alpha.sphere_radius + Real_volume + \n    Mean_B.factor + Mean_alpha.sphere_SA\n\n                                    Df Sum of Sq     RSS    AIC\n<none>                                             87887 525.71\n- Mean_alpha.sphere_SA               1      2636   90524 525.84\n- hydrophobic                        1      2700   90587 525.89\n+ aliphatic                          1      1677   86211 526.33\n- charged                            1      3582   91469 526.59\n+ C_ATOM                             1      1003   86885 526.89\n- Mean_B.factor                      1      4176   92063 527.06\n+ aromatic                           1       521   87367 527.29\n+ C_RESIDUES                         1       473   87415 527.33\n+ negative                           1       273   87614 527.49\n+ positive                           1       273   87614 527.49\n+ small                              1       189   87698 527.56\n+ tiny                               1       148   87740 527.59\n+ polar                              1       103   87785 527.63\n+ Proportion_of_apolar_alpha_sphere  1         0   87887 527.71\n- Mean_alpha.sphere_radius           1      7422   95310 529.55\n- Real_volume                        1   1404611 1492498 727.63\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(slm_stepped)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = score ~ charged + hydrophobic + Mean_alpha.sphere_radius + \n    Real_volume + Mean_B.factor + Mean_alpha.sphere_SA, data = train_score)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-118.179  -21.801    6.118   25.229   96.618 \n\nCoefficients:\n                           Estimate Std. Error t value Pr(>|t|)    \n(Intercept)              -3.742e+01  8.277e+01  -0.452   0.6527    \ncharged                  -8.619e+01  5.296e+01  -1.628   0.1085    \nhydrophobic              -6.769e+01  4.790e+01  -1.413   0.1624    \nMean_alpha.sphere_radius  5.674e+01  2.422e+01   2.343   0.0222 *  \nReal_volume               2.067e-01  6.413e-03  32.231   <2e-16 ***\nMean_B.factor            -6.366e+01  3.623e+01  -1.757   0.0836 .  \nMean_alpha.sphere_SA     -2.241e+02  1.605e+02  -1.396   0.1674    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 36.77 on 65 degrees of freedom\nMultiple R-squared:  0.945,\tAdjusted R-squared:  0.9399 \nF-statistic: 186.1 on 6 and 65 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nhist(slm_original_res, breaks = 10)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(slm_stepped)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-6-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-6-5.png){width=672}\n:::\n:::\n\n\nNous pouvons voir deux lignes horizontales à -100 et 100 ce qui signifie que les variances sont égales et on est dans le cas d'homoscédasticité\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspred_train <- predict.lm(slm_original, newdata = train.dtf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in predict.lm(slm_original, newdata = train.dtf): prediction from\nrank-deficient fit; attr(*, \"non-estim\") has doubtful cases\n```\n\n\n:::\n\n```{.r .cell-code}\nspred_test <- predict.lm(slm_original, newdata = test.dtf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in predict.lm(slm_original, newdata = test.dtf): prediction from\nrank-deficient fit; attr(*, \"non-estim\") has doubtful cases\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(spred_train, train.dtf$score)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(spred_test, test.dtf$score)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsperf_train_lm <- postResample(spred_train, train.dtf$score)\nsperf_test_lm <- postResample(spred_test, test.dtf$score)\nsperf_train_lm\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      RMSE   Rsquared        MAE \n33.8074404  0.9484854 26.0540532 \n```\n\n\n:::\n\n```{.r .cell-code}\nsperf_test_lm\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      RMSE   Rsquared        MAE \n47.6112194  0.9435464 35.8992548 \n```\n\n\n:::\n:::\n\n\n# Regression logistique multiple\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_drugg <- train.dtf[, -which(colnames(train.dtf)==\"score\")]\ntrain_drugg$drugg <- as.factor(train_drugg$drugg)\n\nglm_original <- glm(drugg~., data = train_drugg, family = \"binomial\", maxit = 1000)\nglm_stepped <- step(glm_original, direction = \"both\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStart:  AIC=64.9\ndrugg ~ aromatic + polar + aliphatic + charged + negative + positive + \n    hydrophobic + small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + \n    Mean_alpha.sphere_SA\n\n\nStep:  AIC=64.9\ndrugg ~ aromatic + polar + aliphatic + charged + negative + hydrophobic + \n    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor + \n    Mean_alpha.sphere_SA\n\n                                    Df Deviance    AIC\n- Mean_alpha.sphere_SA               1   32.896 62.896\n- negative                           1   32.898 62.898\n- C_RESIDUES                         1   32.904 62.904\n- tiny                               1   33.079 63.079\n- C_ATOM                             1   33.400 63.400\n- Mean_alpha.sphere_radius           1   33.413 63.413\n- small                              1   33.452 63.452\n- aromatic                           1   33.565 63.565\n- polar                              1   34.054 64.054\n- charged                            1   34.702 64.702\n- Real_volume                        1   34.862 64.862\n<none>                                   32.896 64.896\n- Proportion_of_apolar_alpha_sphere  1   36.164 66.164\n- hydrophobic                        1   36.389 66.389\n- Mean_B.factor                      1   37.928 67.928\n- aliphatic                          1   38.023 68.023\n\nStep:  AIC=62.9\ndrugg ~ aromatic + polar + aliphatic + charged + negative + hydrophobic + \n    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor\n\n                                    Df Deviance    AIC\n- negative                           1   32.899 60.899\n- C_RESIDUES                         1   32.905 60.905\n- tiny                               1   33.079 61.079\n- small                              1   33.507 61.507\n- aromatic                           1   33.591 61.591\n- C_ATOM                             1   33.597 61.597\n- Mean_alpha.sphere_radius           1   33.738 61.738\n- polar                              1   34.200 62.200\n- charged                            1   34.820 62.820\n<none>                                   32.896 62.896\n- Real_volume                        1   35.005 63.005\n- Proportion_of_apolar_alpha_sphere  1   36.166 64.166\n- hydrophobic                        1   36.448 64.448\n+ Mean_alpha.sphere_SA               1   32.896 64.896\n- Mean_B.factor                      1   38.013 66.013\n- aliphatic                          1   38.344 66.344\n\nStep:  AIC=60.9\ndrugg ~ aromatic + polar + aliphatic + charged + hydrophobic + \n    small + tiny + C_ATOM + C_RESIDUES + Mean_alpha.sphere_radius + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor\n\n                                    Df Deviance    AIC\n- C_RESIDUES                         1   32.910 58.910\n- tiny                               1   33.098 59.098\n- aromatic                           1   33.598 59.598\n- C_ATOM                             1   33.689 59.689\n- Mean_alpha.sphere_radius           1   33.810 59.810\n- small                              1   33.858 59.858\n- polar                              1   34.425 60.425\n<none>                                   32.899 60.899\n- Real_volume                        1   35.174 61.174\n- charged                            1   36.373 62.373\n- Proportion_of_apolar_alpha_sphere  1   36.452 62.452\n- hydrophobic                        1   36.722 62.722\n+ negative                           1   32.896 62.896\n+ positive                           1   32.896 62.896\n+ Mean_alpha.sphere_SA               1   32.898 62.898\n- Mean_B.factor                      1   38.030 64.030\n- aliphatic                          1   38.370 64.370\n\nStep:  AIC=58.91\ndrugg ~ aromatic + polar + aliphatic + charged + hydrophobic + \n    small + tiny + C_ATOM + Mean_alpha.sphere_radius + Real_volume + \n    Proportion_of_apolar_alpha_sphere + Mean_B.factor\n\n                                    Df Deviance    AIC\n- tiny                               1   33.100 57.100\n- aromatic                           1   33.598 57.598\n- Mean_alpha.sphere_radius           1   33.817 57.817\n- small                              1   33.859 57.859\n- polar                              1   34.441 58.441\n- C_ATOM                             1   34.460 58.460\n<none>                                   32.910 58.910\n- Real_volume                        1   35.191 59.191\n- charged                            1   36.380 60.380\n- Proportion_of_apolar_alpha_sphere  1   36.628 60.628\n- hydrophobic                        1   36.745 60.745\n+ C_RESIDUES                         1   32.899 60.899\n+ positive                           1   32.905 60.905\n+ negative                           1   32.905 60.905\n+ Mean_alpha.sphere_SA               1   32.910 60.910\n- Mean_B.factor                      1   38.589 62.589\n- aliphatic                          1   39.150 63.150\n\nStep:  AIC=57.1\ndrugg ~ aromatic + polar + aliphatic + charged + hydrophobic + \n    small + C_ATOM + Mean_alpha.sphere_radius + Real_volume + \n    Proportion_of_apolar_alpha_sphere + Mean_B.factor\n\n                                    Df Deviance    AIC\n- aromatic                           1   33.608 55.608\n- Mean_alpha.sphere_radius           1   33.868 55.868\n- small                              1   34.530 56.530\n- C_ATOM                             1   34.567 56.567\n- polar                              1   34.656 56.656\n<none>                                   33.100 57.100\n- Real_volume                        1   35.325 57.325\n- charged                            1   36.380 58.380\n- Proportion_of_apolar_alpha_sphere  1   36.703 58.703\n- hydrophobic                        1   36.803 58.803\n+ tiny                               1   32.910 58.910\n+ negative                           1   33.079 59.079\n+ positive                           1   33.079 59.079\n+ C_RESIDUES                         1   33.098 59.098\n+ Mean_alpha.sphere_SA               1   33.100 59.100\n- Mean_B.factor                      1   38.599 60.599\n- aliphatic                          1   44.497 66.497\n\nStep:  AIC=55.61\ndrugg ~ polar + aliphatic + charged + hydrophobic + small + C_ATOM + \n    Mean_alpha.sphere_radius + Real_volume + Proportion_of_apolar_alpha_sphere + \n    Mean_B.factor\n\n                                    Df Deviance    AIC\n- Mean_alpha.sphere_radius           1   34.054 54.054\n- small                              1   34.553 54.553\n- polar                              1   34.659 54.659\n- C_ATOM                             1   34.851 54.851\n- Real_volume                        1   35.590 55.590\n<none>                                   33.608 55.608\n- charged                            1   36.588 56.588\n- Proportion_of_apolar_alpha_sphere  1   36.818 56.818\n- hydrophobic                        1   36.839 56.839\n+ aromatic                           1   33.100 57.100\n+ Mean_alpha.sphere_SA               1   33.585 57.585\n+ tiny                               1   33.598 57.598\n+ C_RESIDUES                         1   33.606 57.606\n+ positive                           1   33.608 57.608\n+ negative                           1   33.608 57.608\n- Mean_B.factor                      1   38.671 58.671\n- aliphatic                          1   45.487 65.487\n\nStep:  AIC=54.05\ndrugg ~ polar + aliphatic + charged + hydrophobic + small + C_ATOM + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor\n\n                                    Df Deviance    AIC\n- small                              1   34.621 52.621\n- polar                              1   35.115 53.115\n- C_ATOM                             1   35.132 53.132\n<none>                                   34.054 54.054\n- Real_volume                        1   36.672 54.672\n- charged                            1   36.694 54.694\n- hydrophobic                        1   37.146 55.146\n+ Mean_alpha.sphere_radius           1   33.608 55.608\n- Proportion_of_apolar_alpha_sphere  1   37.756 55.756\n+ aromatic                           1   33.868 55.868\n+ Mean_alpha.sphere_SA               1   33.965 55.965\n+ negative                           1   34.027 56.027\n+ positive                           1   34.027 56.027\n+ tiny                               1   34.051 56.051\n+ C_RESIDUES                         1   34.053 56.053\n- Mean_B.factor                      1   38.683 56.683\n- aliphatic                          1   45.538 63.538\n\nStep:  AIC=52.62\ndrugg ~ polar + aliphatic + charged + hydrophobic + C_ATOM + \n    Real_volume + Proportion_of_apolar_alpha_sphere + Mean_B.factor\n\n                                    Df Deviance    AIC\n- C_ATOM                             1   36.158 52.158\n- polar                              1   36.395 52.395\n<none>                                   34.621 52.621\n- charged                            1   36.694 52.694\n- Real_volume                        1   37.561 53.561\n+ small                              1   34.054 54.054\n- hydrophobic                        1   38.368 54.368\n+ tiny                               1   34.394 54.394\n+ positive                           1   34.505 54.505\n+ negative                           1   34.505 54.505\n+ Mean_alpha.sphere_SA               1   34.544 54.544\n+ Mean_alpha.sphere_radius           1   34.553 54.553\n+ C_RESIDUES                         1   34.593 54.593\n+ aromatic                           1   34.612 54.612\n- Mean_B.factor                      1   38.986 54.986\n- Proportion_of_apolar_alpha_sphere  1   41.255 57.255\n- aliphatic                          1   46.672 62.672\n\nStep:  AIC=52.16\ndrugg ~ polar + aliphatic + charged + hydrophobic + Real_volume + \n    Proportion_of_apolar_alpha_sphere + Mean_B.factor\n\n                                    Df Deviance    AIC\n<none>                                   36.158 52.158\n- Real_volume                        1   38.317 52.317\n+ C_ATOM                             1   34.621 52.621\n+ C_RESIDUES                         1   34.713 52.713\n- charged                            1   38.804 52.804\n- polar                              1   38.863 52.863\n+ small                              1   35.132 53.132\n+ Mean_alpha.sphere_radius           1   35.343 53.343\n- Mean_B.factor                      1   39.461 53.461\n+ tiny                               1   35.596 53.596\n+ Mean_alpha.sphere_SA               1   35.879 53.879\n+ aromatic                           1   36.092 54.092\n+ negative                           1   36.103 54.103\n+ positive                           1   36.103 54.103\n- hydrophobic                        1   40.960 54.960\n- Proportion_of_apolar_alpha_sphere  1   42.597 56.597\n- aliphatic                          1   48.568 62.568\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(glm_original$fitted.values, train_drugg$drugg)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglm_ori_res <- glm_original$residuals\nglm_stp_res <- glm_stepped$residuals\nhist(glm_ori_res, breaks = 10)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\nhist(glm_stp_res, breaks = 10)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(glm_ori_res)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-10-3.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(glm_stp_res)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-10-4.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndtf_train_clean <- train.dtf[, which(!colnames(dtf_new) %in% c(\"C_RESIDUES\", \"positive\", \"Real_volume\"))]\np_values <- NULL\n\nfor (i in 1:(length(clean_dtf)-1)) {\n  glm_tmp <- glm(dtf_train_clean$drugg~dtf_train_clean[, i], family = \"binomial\", maxit = 1000)\n  summary_model <- summary(glm_tmp)\n  p_value <- summary_model$coefficients[, \"Pr(>|z|)\"][2]\n  p_values <- c(p_values, p_value)\n}\n\nnames(p_values) <- colnames(dtf_train_clean)[2:14]\nval_desc <- names(p_values[which(p_values<0.05)])\ndtf_train_final <- train_log[c(\"drugg\", val_desc)]\n```\n:::\n\n\nNous pouvons voir deux lignes horizontales à -100 et 100 ce qui signifie que les variances sont égales et on est dans le cas d'homoscédasticité\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndpred_train_logi <- predict.glm(glm_stepped, newdata = train.dtf, type = \"response\")\ndpred_test_logi <- predict.glm(glm_stepped, newdata = test.dtf, type = \"response\")\n\ndpred_train_logi_round <- as.factor(round(dpred_train_logi))\ndpred_test_logi_round <- as.factor(round(dpred_test_logi))\n\nplot(dpred_train_logi, train.dtf$drugg)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(dpred_test_logi, test.dtf$drugg)\n```\n\n::: {.cell-output-display}\n![](tp3_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nconfusionMatrix(dpred_train_logi_round, train.dtf$drugg)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction  0  1\n         0 20  4\n         1  5 43\n                                          \n               Accuracy : 0.875           \n                 95% CI : (0.7759, 0.9412)\n    No Information Rate : 0.6528          \n    P-Value [Acc > NIR] : 1.79e-05        \n                                          \n                  Kappa : 0.7216          \n                                          \n Mcnemar's Test P-Value : 1               \n                                          \n            Sensitivity : 0.8000          \n            Specificity : 0.9149          \n         Pos Pred Value : 0.8333          \n         Neg Pred Value : 0.8958          \n             Prevalence : 0.3472          \n         Detection Rate : 0.2778          \n   Detection Prevalence : 0.3333          \n      Balanced Accuracy : 0.8574          \n                                          \n       'Positive' Class : 0               \n                                          \n```\n\n\n:::\n\n```{.r .cell-code}\nconfusionMatrix(dpred_test_logi_round, test.dtf$drugg)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction  0  1\n         0 11  4\n         1  3 19\n                                          \n               Accuracy : 0.8108          \n                 95% CI : (0.6484, 0.9204)\n    No Information Rate : 0.6216          \n    P-Value [Acc > NIR] : 0.01111         \n                                          \n                  Kappa : 0.6034          \n                                          \n Mcnemar's Test P-Value : 1.00000         \n                                          \n            Sensitivity : 0.7857          \n            Specificity : 0.8261          \n         Pos Pred Value : 0.7333          \n         Neg Pred Value : 0.8636          \n             Prevalence : 0.3784          \n         Detection Rate : 0.2973          \n   Detection Prevalence : 0.4054          \n      Balanced Accuracy : 0.8059          \n                                          \n       'Positive' Class : 0               \n                                          \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pROC)\nroc_curve_test <- roc(test.dtf$drugg, pred_test_logi)\n\nplot(roc_curve_test)\nlegend(\"bottomright\", legend = paste(\"AUC = \", round(auc(roc_curve_test), 2)), col = \"blue\", lty = 1)\n\nroc_curve_train <- roc(train.dtf$drugg, pred_train_logi)\n\nplot(roc_curve_train)\nlegend(\"bottomright\", legend = paste(\"AUC = \", round(auc(roc_curve_train), 2)), col = \"blue\", lty = 1)\n```\n:::\n",
    "supporting": [
      "tp3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}